---
layout: post
title:  "Gameboy LCD"
date:   2019-12-25 15:41:17 +0000
categories: 
---

## Slippery slope
This was a simple repair project that spiralled out of control. I came upon an original Nintendo Gameboy that had a failed LCD screen with many horizontal lines of pixels missing. I followed an online tutorial that explained how you can reheat the glue that attaches the flex cable to the LCD with a soldering iron to get it working again. Well, that didn't work for me and I ended up burning through the flex.  A quick search showed the original LCD is no longer available, and no aftermarket replacement. Game over.

## Interfacing to the Gameboy 
Fortunately, the schematics for the original gameboy are widely available, and the LCD interface has been [reverse engineered][longhorn].
The LCD is 160x144 pixels and each pixel can show four levels of grayscale (more like four levels of a muddy green colour!).  The electrical interface is as simple as it gets with two bits of data that represent the four gray levels. A vertical sync signal is asserted along with the first line (0 of 144) and a horizontal sync signal along with the first pixel of every line. Each pixel is indicated by a rising edge on a 4MHz clock.  The 4MHz clock sounds pretty pedestrian these days but it's plenty fast enought to refresh the display 60 times a second.

## Microcontroller to the rescue
For my first attempt I used an STM32 microcontroller board (widely known as the 'blue pill' on the internet) and one of the ubiqitous [ILI9341][ili9341] LCD displays. Clones of the blue pill board can be found for next to nothing on AliExpress and the [Eclipse][eclipse] toolchain will get you up and running.
It's possible to configure one of the DMA controllers on the STM32 to capture a synchronous parallel bus into RAM (which is what the gameboy interface is!) up to about 10MHz.  ST have written an app note [AN4666][an4666] that explains how to do this. 

[longhorn]: http://longhornengineer.com/category/projects/hardware/gameboy-dmg-01-vga/
[ili9341]: https://www.adafruit.com/product/1770
[an4666]: https://www.st.com/content/ccc/resource/technical/document/application_note/7a/88/df/e3/d3/36/40/29/DM00169730.pdf/files/DM00169730.pdf/jcr:content/translations/en.DM00169730.pdf
[eclipse]: https://gnu-mcu-eclipse.github.io/
